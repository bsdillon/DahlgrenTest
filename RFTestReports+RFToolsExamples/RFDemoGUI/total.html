<!DOCTYPE html>
<html>
 <head>
  <title>Total Results</title>
  <style></style>
  <script id="dataSourceFile" src="demodata.js"></script>
  <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
  <script src="https://bsdillon.github.io/DahlgrenTest/html/graphing/piechartlibrary.js"></script>
  <script src="https://github.com/bsdillon/DahlgrenTest/blob/master/RFTestReports%2BRFToolsExamples/chartjs/utils.js"></script>
  <script src="linechartlibrary.js"></script>
  <script> 
    function oqe(x){
      var link = x +".html";
      var windowFeatures = "menubar=yes,location=yes,resizable=no,scrollbars=yes,status=yes,left=100,top=100";
      var newWindow = null;
      window.open(link, newWindow, windowFeatures);
    }  

    function loadTable(){ <!-- Need to fix style things and add expansion capabilities -->
     var table = document.getElementById("total");
     var data = Object.keys(testCases);
     let thead = table.createTHead();
     let row = thead.insertRow(); 
     let title = document.createTextNode("Test Cases");
     let cell = row.insertCell(); 
     cell.appendChild(title);
     for(let element of data){
      let row = table.insertRow();
      let cell = row.insertCell();
      let text = document.createTextNode(element + "  ");
      var oqeLink = document.createElement("BUTTON");
      oqeLink.onclick =  (function(element){ return function(){oqe(element);}})(element);
      oqeLink.innerHTML = 'OQE';
      cell.appendChild(text);
      cell.appendChild(oqeLink);
      var actualdata = testCases[element];
      var data1 = Object.keys(actualdata[0]);
      var subtable = document.createElement("TABLE");
      subtable.id = "sub" + element;
      subtable.style.borderWidth = "thick";
      generateTableHead(subtable, data1);
      generateTable(subtable, actualdata);
      cell.appendChild(subtable);
     }
    }

    function loadData(){ 
     loadPieChart();
     loadLineChart();
    }
    
     function loadLineChart(){
      var config2 = createLineConfig(LINE_TYPE, "Pass/Fail Percentage vs. Test Run", "Test Run", "Percentage");    
      var chart2 = createChart("canvas2", 350, 350, config2);
      var XData = Object.keys(testCases);
      alert(XData);
      setLineChartLabels(config2, XData);
      var passPercent =[];  <!-- For Tuesday: Use array names to parameterize process below to turn into function-->
      var failPercent =[];
      var data = Object.keys(testCases);
      for(let element of data){
        var subdata = testCases[element];
        var length = Object.keys(subdata).length;
        var pass = 0;
        var fail = 0;
        var other = 0;
        for(var i=0; i<length; i++) {
          if(subdata[i].Status == 'Pass') {
            pass = pass + 1;
          } else if(subdata[i].Status == 'Fail'){
            fail = fail + 1;
          }else{
            other = other + 1;
          }
        }
        var passP = (pass / (pass + fail + other))*100; 
        var failP = (fail /(pass + fail + other))*100;
        passPercent.push(passP);
        failPercent.push(failP);
        if(element == 'testCase3'){break;}
      }
      createLineDataSet(config2, "Pass Percentage", passPercent, LINE_TYPE);
      createLineDataSet(config2, "Fail Percentage", failPercent, LINE_TYPE); 
      chart2.update();
     }
    
     

     function loadPieChart(){
       var config1 = createConfig("Pass vs. Fail");
       var chart1 = createChart("canvas1", 350,350,config1);
       let labels =['Fail','Pass', 'Not Run'];
       setLabels(config1, labels);
       var pass = 0;
       var fail = 0;
       var other = 0;
       var data = Object.keys(testCases);
       for(let element of data){
         var subdata = testCases[element];
         var length = Object.keys(subdata).length;
         for(var i=0; i<length; i++) {
           if(subdata[i].Status == 'Pass') {
            pass = pass + 1;
           } else if(subdata[i].Status == 'Fail'){
            fail = fail + 1;
           }else{
            other = other + 1;
           }
         }
         data1 = [fail, pass, other];
         if(element == 'testCase3'){break;}
        }
       createDataSet(config1, data1);
       chart1.update();
    }

    function startData(){
     loadTable();
     loadData();
    }

  </script>
 </head>
 <body onload = "startData()">
  <table id="total" border="5"></table>
  <br>
  <h2>Overall Test Breakdown</h2>   
  <canvas id="canvas1"></canvas>
  <br>
  <h2> Performance Over Time </h2>
  <canvas id="canvas2"></canvas>
 </body>
</html>
