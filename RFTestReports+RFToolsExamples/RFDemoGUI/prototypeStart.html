<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Demo</title>
    <style>
      table.standard td {width:25px; height: 25px;}
    </style>   
    <script id = "dataSourceFile" src="demodata.js"></script>
    <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
    <script src="https://bsdillon.github.io/DahlgrenTest/html/graphing/piechartlibrary.js"></script>
    <script>
        function generateHeatMapRows(table, data){
          for(let element of data) {
             table.insertRow();
          }
        }
        function generateHeatMapColumns(table, data){
          for (var i = 0; i < table.rows.length; i++) {
            cell = table.rows[i].insertCell(table.rows[i].cells.length);
            let element = data[i];
            var status = element.Status;
            if(status == 'Pass') {
              cell.style.backgroundColor = "green";
            }else if(status == 'Fail') {
              cell.style.backgroundColor = "red";
            }else{
              cell.style.backgroundColor = "blue";
            }
            if (i === 4) { break;}
          }
         }


     function generateHeatMap(){
      var heatMap = document.getElementById('heatmap');
      generateHeatMapRows(heatMap, testCases.testCase0);
      var testRuns = 3;
      for(var j=0; j<testRuns; j++){
        var array = testCases["testCase" + j];
        generateHeatMapColumns(heatMap, array);
      }
      setTimeout(function(){ timedUpdate(heatMap); }, 5000);    
     }

     function timedUpdate(table) {
      document.getElementById("dataSourceFile").remove();
      table.innerHTML = "";
      var paragraphs = document.getElementsByTagName('paragraph');
 
      var head= document.getElementsByTagName('head')[0];
      var script= document.createElement('script');
      script.src= 'demodata.js';
      script.id='dataSourceFile';
      head.appendChild(script);
      var heatMap = document.getElementById('heatmap');
      generateHeatMapRows(heatMap, testCases.testCase0);
      var testRuns = 3;
      for(var j=0; j<testRuns; j++){
        var array = testCases["testCase" + j];
        generateHeatMapColumns(heatMap, array);
      }
      setTimeout(function(){ timedUpdate(heatMap); }, 5000);       
     }
     
     
      function totalStatus(data, paragraph){ <!-- Figure out how to use this to generate status text in GUI -->
          var pass = 0;
          var fail = 0;
          var other = 0;
          var stat = '';
          for(let element of data){
            if(element.Status == 'Pass') {
              pass = pass + 1;
              
            } else if(element.Status == 'Fail'){
              fail = fail + 1;
   
            } else {
              other = other + 1;
            }
          }
         if (other != 0){
          stat = 'Running ...';
         }else if(pass > fail){
          stat = 'Pass';
         }else{
          stat= 'Fail';
         }
         var text = document.createTextNode(stat + "    ");
         var paragraph = document.getElementById(paragraph);
         paragraph.appendChild(text);
       }   
       
       function oqe(x){
        var link = "jshtmlExample"+ x +".html";
        var windowFeatures = "menubar=yes,location=yes,resizable=no,scrollbars=yes,status=yes,left=100,top=100";
        var newWindow = null;
        window.open(link, newWindow, windowFeatures);
       }  
      
       function generateStatus(data){
        var length = Object.keys(data).length;
        for(var i=0; i<length; i++){
         var para = document.createElement("P");
         para.id = 'status'+ i;
         document.body.appendChild(para);
         var test = document.createTextNode("Test Run " + i + "    ");
         para.appendChild(test);
         var actualdata = testCases["testCase" + i];
         totalStatus(actualdata, para.id);
         var button = document.createElement("BUTTON")
         button.id = 'oqe' + i;
         button.onclick = (function(i){ return function(){oqe(i+1);}})(i);
         button.innerHTML = 'OQE';
         para.appendChild(button);
         setTimeout(function(){ timedUpdate(heatMap,); }, 5000); 
        }
       }
       
       
    
    </script>
</head>
<body onload = "generateHeatMap()">
  <table id="heatmap" class ="standard"></table>
  <h2> Tests </h2>  
  <script>generateStatus(testCases);</script>
</body>
</html>
