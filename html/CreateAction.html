<!DOCTYPE html>
<html>
  <head>
    <title>Creating an Action</title>
    <style>
      body {width:500px;}
      code {color:blue; font-weight:bold;}
      .normal {color:#444444; font-weight:normal; font-style:italic; text-align:right;}
      img {border: solid black 2px; width:400px;}
    </style>
    <script>
    </script>
  </head>
  <body>
    <h3 class="assignment">Instructions on how to create an action</h3>
    <p>This is a <a href="https://lab.github.com/githubtraining/github-actions:-hello-world">link 
      at GitHub</a> that generates a tutorial. The tutorial isn't fantastic, but it does generate 
      a successful action that can be learned from. The full transcript is available 
      <a href="https://github.com/bsdillon/hello-github-actions/pull/2">here</a>.
    </p>
    <p>Note the following:</p>
    <ul>
      <li>Workflows are defined in special files in the .github/workflows directory, named main.yml. 
        If there is an action it has to be started from this directory and be found in the main.yml file.
      </li>
      <li>
<code>name: A workflow for my Hello World file </code><br>
<span class="normal">//This is the full name that will show up in the action page.</span><br>
<code>on: push </code><br>
<span class="normal">//This is the event that will cause the action to fire</span><br>
<code>jobs:</code><br>
<code>&nbsp;&nbsp;build:</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;name: Hello world action </code><br>
<span class="normal">//This is the name of the build action</span><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;runs-on: ubuntu-latest</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;steps:</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- uses: actions/checkout@v1</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- uses: ./action-a </code><br>
<span class="normal">//This is the folder with a script. The path is relative from the root directory.</span><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with:</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MY_NAME: "Mona" </code><br>
<span class="normal">//This is a parameter to the script</span>
<br>
<img alt="Action for hello world" src="./imgs/action1.png" /><br><br><br>
<img alt="Jobs within the action" src="./imgs/action2.png" /><br><br><br>
<img alt="Steps in a job" src="./imgs/action3.png" /><br>
      </li>
      <li>The action-a script is another layer of complexity<br>
<code>name: "Hello Actions"</code><br>
<code>description: "Greet someone"</code><br>
<code>author: "octocat@github.com"</code><br>
<br>
<code>inputs:</code><br>
<code>&nbsp;&nbsp;MY_NAME:</code><br>
<span class="normal">//This is the parameter to the action that comes from the main YML.</span><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;description: "Who to greet"</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;required: true</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;default: "World"</code><br>
<br>
<code>runs:</code><br>
<code>&nbsp;&nbsp;using: "docker"</code><br>
<code>&nbsp;&nbsp;image: "Dockerfile" </code><br>
<span class="normal">//Note that the docker tool is used to create a docker image according to this script.</span><br>
<br>
<code>branding:</code><br>
<code>&nbsp;&nbsp;icon: "mic"</code><br>
<code>&nbsp;&nbsp;color: "purple"</code>
      </li>
      <li>
          The docker script adds a third layer of complexity. At this point
          at least this code is more direct.<br>
<code>FROM debian:9.5-slim</code><br>
<br>
<code>ADD entrypoint.sh /entrypoint.sh </code><br>
<span class="normal">//The script is added to the docker image so the code can be run in the container.</span><br>
<code>RUN chmod +x /entrypoint.sh </code><br>
<span class="normal">//Chmod changes the permissions on a file. In this case allowing it to be run as a script.</span><br>
<code>ENTRYPOINT ["/entrypoint.sh"] </code><br>
<span class="normal">//This keyword makes that script an executable external interface of the container.</span>
      </li>
      <li>
          The script itself is a pretty simple bit of code.<br>
<code>#!/bin/sh -l </code><br>
<span class="normal">//This is the required "shebang" indicating the kind of script.</span><br>
<span class="normal">//sh invokes the standard command interpreter. I have no idea what -l does</span><br>
<code>sh -c "echo Hello world my name is $INPUT_MY_NAME" </code><br>
<span class="normal">&lt;-- sh means run as a script. Option c treats the string like a single command.</span>
      </li>
      <li>
          Note that when the main.yml executes it creates an Ubutu OS image for the runtime environment.
          This in accordance with the script and confirmed in the execution output.<br>
<img alt="YML script" src="./imgs/action4.png" /><br><br>
          In action-a, however, the Dockerfile requires a Debian OS image. In the execution output it can
          be seen that #1 Docker is spinning up a debian environment. Steps #2 through #4 follow the docker
          script creating a container with the required entry point/interface. The output #5 is the result
          of the uses statement in main.yml. Apparently the entry point/interface is executed automatically.<br>
<img alt="Corresponding output" src="./imgs/action-a.png" />
      </li>
      <li>
        <b>CURRENT WORKING THEORY</b>: main.yml subordinates all actions which may be individiually defined in separate folders.
          within that folder, the yml script can subordinate any additional scripts. In this case there is a docker script to create
          the container, insert the script, and make that script an executable for that container.<br><br>
          As a result of this system two containers are created and executed in the following steps:<br>
        <ol>
          <li>Main.yml creates the checkout container with all code.</li>
          <li>Main.yml uses the action-a yml script which initially sets up a temporary container with Docker.
            <ol start="3">
              <li>The docker script adds the entrypoint.sh script to the container.</li>
              <li>The docker script makes that entrypoint script the EntryPoint/interface for the container.</li>
            </ol>
          </li>
          <li value="5">The container created by action-a is executed with the parameter Mona.</li>
          <li>That execution takes place.
            <ol start="7">
              <li>The entrypoint.sh script executes and sends output to screen.</li>
            </ol>
          </li>
        </ol>
        <img alt="Workflow diagram" src="./imgs/action5.png" />
      </li>
    </ul>
  </body>
</html>
