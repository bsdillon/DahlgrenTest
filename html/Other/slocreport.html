<!DOCTYPE html>
<html>
  <head>
    <title>Code Growth over Time</title>
    <link rel="stylesheet" type="text/css" href="../common.css">
    <style>
    </style>
    <script src="../graphing/utils/Chart.min.js"></script>
    <script src="../graphing/utils/utils.js"></script>
    <script src="./createlinechart.js"></script>
    <script src="./../cidata/sloc_history.js"></script>
    <script>
      var myLine;
      var config;

      function emptytt()
      {
      }

      function loadData()
      {
        width = 600;
        height = 600;
        config = createConfig('Code size by language', 'Date', 'SLOC',emptytt, true);
        myLine = createChart("can",width,height,config);

        processData();
        myLine.update();
      }

      function processData()
      {
        var fileData = {};
        var format = {day: '2-digit', month: '2-digit', year: 'numeric'};
        var raws = [];
        var labels = [];
        var langs = {};
        var counters = {};
        for(const [key, value] of Object.entries(slocs))
        {
          var d = new Date(Date.parse(key));
          var sec = d.getTime()
          raws.push(sec);
          fileData[sec]=value;

          for(const [key2, num] of Object.entries(value))
          {
            if(!(key2 in langs))
            {
              langs[key2]=[];
              counters[key2]=0;
            }
          }
        }

        raws.sort();

        var count = 0;
        for(let i=0;i<raws.length;i++)
        {
          var d = new Date(raws[i]);
          var date = d.toLocaleDateString('en-US', format);
          labels.push(date);
          count++;

          for(key2 in fileData[raws[i]])
          {
            var num = fileData[raws[i]][key2];
            langs[key2].push(num);
            counters[key2]++;
          }

          for(const [key, value] of Object.entries(counters))
          {
            if(value<count)
            {
              langs[key].push(langs[key][count-2]);//reuse the last number
              counters[key]++;
            }
          }
        }

        setChartLabels(config, labels);

        for (const [lang,set] of Object.entries(langs))
        {
          createRandomStyleArea(config, lang, set);
        }
      }
    </script>
  </head>
  <body onload="loadData()">
    <canvas id="can"></canvas>
    <div id="messageData" class="mobile"></div>
  </body>
</html>
