---
name: Python Linting
# fix truthy warning per
# https://github.com/adrienverge/yamllint/issues/158#issuecomment-586706596
# yamllint disable-line rule:truthy
on:
  push:
    paths:
      - "**.py"
      - ".github/workflows/PythonLint.yml"
jobs:
  Linting_with_flake8:
    runs-on: ubuntu-18.04
    steps:
      - name: Setup code
        uses: actions/checkout@master
      - name: Setup python
        uses: actions/setup-python@v1
      - uses: actions/checkout@v1
      - name: Install flake8
        run: |
          python -m pip install --upgrade pip
          pip install flake8
      - name: check flake8
        run: |
          flake8 . \
            --count \
            --select=E9,F63,F7,F82 \
            --show-source \
            --statistics > py_lint.txt
      - name: Run Contributor Stats
        if: ${{ failure() }}
        run: python .github/ciPython/py_lint.py py_lint.txt
      - name: Commit daily and total commits
        if: ${{ failure() }}
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub  Action"
          git add ./html/py_lint_log.txt
          git commit -m "Update Python Lint Log" -a
      - name: Push changes
        if: ${{ failure() }}
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: 'KKBranch'

  Linting_with_WhyNot:
    runs-on: ubuntu-18.04
    steps:
      - name: Setup code
        uses: actions/checkout@master
      - name: Setup python
        uses: actions/setup-python@v1
      - name: check Whynot
        uses: WhyNotHugo/python-linting@v1.0.0
